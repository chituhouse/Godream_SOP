# 鸽梦项目上下文 - 项目全局状态

**最后更新**: 2025-11-18
**当前版本**: v1.0.1 正式版
**重构阶段**: 准备开始

---

## 📊 项目快照

### 核心信息
- **项目名称**: 鸽梦 (GoDream)
- **项目类型**: 桌面级 AI 创作平台
- **技术栈**: Python 3.x + PyQt5
- **平台支持**: macOS / Windows
- **开发模式**: 纯 AI 编程（Claude Code + Codex）

### 核心功能（仅2个）
1. **Seedream（图像生成）**
   - 文生图
   - 图生图
   - 状态：✅ 正常

2. **Seedance（视频生成）**
   - 文生视频
   - 图生视频
   - 状态：⚠️ 有网络错误bug（待修复）

### 已移除功能
- ❌ GLM对话功能（UI已移除，后端代码残留）

---

## 🏗️ 当前架构状态

### 代码结构
```
总行数: ~15,000行
├── qt_app.py (10,372行) ⚠️ 巨石文件
├── modules/
│   ├── seedream/     ✅ 图像生成
│   ├── seedance/     ⚠️ 视频生成（有bug）
│   ├── glm/          ❌ 残留代码（待删除）
│   ├── storage/      ✅ 统一存储
│   └── repository/   ✅ 数据仓库
├── components/       ✅ UI组件
└── services/         📝 待创建（重构目标）
```

### 技术债务
1. **严重**：qt_app.py 10,372行巨石文件
2. **严重**：配置管理分散在4个模块
3. **中等**：GLM 残留代码无用但占空间
4. **中等**：视频生成网络错误（用户体验差）

---

## 🎯 重构目标

### 总体目标
- 时间窗口：2周（12-14天）
- 策略：渐进式重构
- 风险控制：每阶段验收 + Git tag

### 预期成果
- qt_app.py 减少到 < 3,000行（减少70%）
- 创建独立的服务层（图像、视频、配置）
- 配置管理单一数据源
- GLM 代码完全移除
- 视频生成bug修复

---

## ⚠️ 已知问题清单

### P0（紧急）
- [ ] 视频生成报网络错误（Seedance API 连接问题）

### P1（重要）
- [ ] GLM 代码残留（约2000+行无用代码）
- [ ] qt_app.py 巨石文件难以维护
- [ ] 配置管理混乱（4个模块）

### P2（优化）
- [ ] 缺少自动化测试
- [ ] 错误提示不够精确
- [ ] 缺少日志记录机制

---

## 🚀 重构进度追踪

### 阶段0：紧急修复（1-2天）
- [ ] 诊断视频生成网络错误
- [ ] 实施修复
- [ ] 测试验证

### 阶段1：快速胜利（5天）
- [ ] Task 1.1: 清理GLM残留代码（1天）
- [ ] Task 1.2: 提取图像生成服务（2天）
- [ ] Task 1.3: 提取视频生成服务（2天）

### 阶段2：核心重构（7天）
- [ ] Task 2.1: 统一配置管理（2天）
- [ ] Task 2.2: 拆分 qt_app.py（4天）
- [ ] Task 2.3: 基础测试（1天，可选）

---

## 📝 重要约束

### Codex 执行约束
**禁止修改的文件**：
- `modules/seedream/manager.py` - 核心业务逻辑
- `modules/seedance/manager.py` - 核心业务逻辑
- `modules/storage/*` - 存储系统
- `modules/repository/*` - 仓库系统
- `edition/*` - 版本控制

**强制要求**：
- 所有删除必须先确认无引用
- 所有重构必须保持接口兼容
- 每个阶段必须通过测试验收
- 所有变更必须记录到 REFACTOR_LOG.md

---

## 🔄 回滚检查点

### Git Tags
- `phase0-bugfix-complete` - 视频bug修复完成
- `phase1-service-layer-complete` - 服务层提取完成
- `phase2-ui-split-complete` - UI拆分完成

### 如何回滚
```bash
# 如果阶段2出现问题，回滚到阶段1
git reset --hard phase1-service-layer-complete
```

---

## 📊 关键指标

### 代码质量
- 当前：qt_app.py 10,372行
- 目标：qt_app.py < 3,000行
- 减少幅度：70%+

### 功能稳定性
- 图像生成成功率：100%（目标）
- 视频生成成功率：0%（当前） → 100%（目标）
- 跨平台兼容性：macOS + Windows（目标）

---

## 🔗 相关文档

- [重构执行日志](.claude/REFACTOR_LOG.md)
- [Codex 指挥手册](.claude/CODEX_INSTRUCTIONS.md)
- [总体规划](../docs/refactor/MASTER_PLAN.md)
- [架构分析](../docs/refactor/architecture/current_state.md)

---

**注意**：本文件会随着重构进展持续更新，每日至少更新一次。
